{% extends "base_plugin.html" %}
{% set update_interval = 5000 %}

{% block pluginscripts %}
<script>
  $(document).ready( function () {
    $(window).trigger('datatables_defaults');
		try {
      table1 = $('#read').DataTable();
      table2 = $('#write').DataTable();
		}
		catch (e) {
			console.log("Datatable JS not loaded, showing standard table without reorder option " +e);
    }

  });
</script>
<script>
	function handleUpdatedData(response, dataSet=null) {
		if (dataSet === null) {
			var objResponse = JSON.parse(response);
			myProto = document.getElementById(dataSet);
      for (var item in objResponse['read']) {
        shngInsertText (item+'_value', objResponse['read'][item]['value'], 'read', 2);
        shngInsertText (item+'_lastupdate', objResponse['read'][item]['update'], 'read', 2);
        shngInsertText (item+'_lastchange', objResponse['read'][item]['change'], 'read', 2);
			}
      for (var item in objResponse['write']) {
        shngInsertText (item+'_value', objResponse['write'][item]['value'], 'write', 2);
        shngInsertText (item+'_lastupdate', objResponse['write'][item]['update'], 'write', 2);
        shngInsertText (item+'_lastchange', objResponse['write'][item]['change'], 'write', 2);
			}
		}
	}
</script>

{% endblock pluginscripts %}
{% set logo_frame = false %}

{% set tab1title = "<strong>" ~ p.get_shortname() ~ " Read Items</strong> (" ~ item_count_read ~ ")" %}
{% set tab2title = "<strong>" ~ p.get_shortname() ~ " Write Items</strong> (" ~ item_count_write ~ ")" %}

{% set tabcount = 2 %}

{% block headtable %}
{% set item_count = item_count_read + item_count_write %}
<table class="table table-striped table-hover" style="min-width:550px;">
  <tbody>
    <tr>
      <td class="py-1"><strong>{{ _('Host') }}</strong><br>
        <span id="host">{{ p._webdata['host'] }}</span></td>
      <td class="py-1"><strong>{{ _('Port') }}</strong><br>
        <span id="host">{{ p._webdata['port'] }}</span></td>
      <td class="py-1"><strong>{{ _('Slave') }}</strong><br>
        <span id="slave">{{ p._webdata['slave'] }}</span></td>
    </tr>
    <tr>
    <td class="py-1"><strong>{{ _('Cycle') }}</strong><br>
      <span id="cycle">{{ p._webdata['cycle'] }}</span></td>
    <td class="py-1"><strong>{{ _('Retries') }}</strong><br>
      <span id="retries">{{ p._webdata['retries'] }}</span></td>
    <td class="py-1"><strong>{{ _('Items') }}</strong><br>
      <span id="items">{{ item_count }}</span></td>
    </tr>

  </tbody>
</table>
{% endblock headtable %}

{% block bodytab1 %}
<div class="container-fluid m-2 table-resize">
  <div class="mb-2">

    {{ _('Die folgenden Items werden vom Inverter gelesen') }}.
  </div>
  <table id="read">
    <thead>
    <tr>
      <th></th>
      <th>{{ _('Item') }}</th>
      <th class="value">{{ _('Wert') }}</th>
      <th class="update">{{ _('Letztes Update') }}</th>
      <th class="change">{{ _('Letzte Änderung') }}</th>
      <th class="slave">{{ _('Slave') }}</th>
      <th class="equipment">{{ _('Equipment') }}</th>
      <th class="init">{{ _('Init') }}</th>
      <th class="skip">{{ _('Skip') }}</th>
      <th class="cycle">{{ _('Cycle') }}</th>
    </tr>
    </thead>
    <tbody>
    {% for item in p._read_item_dictionary %}
        <tr id="{{ item }}">
          <td></td>
          <td class="py-1" id="{{ item }}_path">{{ item }}</td>
          <td class="py-1" id="{{ item }}_value">{{ item.property.value }}</td>
          <td class="py-1" id="{{ item }}_lastupdate">
            {{ item.property.last_update.strftime('%d.%m.%Y %H:%M:%S') }}
          </td>
          <td class="py-1" id="{{ item }}_lastchange">
            {{ item.property.last_change.strftime('%d.%m.%Y %H:%M:%S') }}
          </td>
          <td class="py-1" id="{{ item }}_slave">{{ p._read_item_dictionary[item].slave }}</td>
          <td class="py-1" id="{{ item }}_equipment">{{ p._read_item_dictionary[item].equipment }}</td>
          <td class="py-1" id="{{ item }}_initialized">{{ p._read_item_dictionary[item].initialized }}</td>
          <td class="py-1" id="{{ item }}_skip">{{ p._read_item_dictionary[item].skip }}</td>
          <td class="py-1" id="{{ item }}_cycle">{{ p._read_item_dictionary[item].cycle }}</td>
        </tr>

    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock bodytab1 %}
{% block bodytab2 %}
<div class="container-fluid m-2 table-resize">
  <div class="mb-2">

    {{ _('Die folgenden Items können gechrieben werden') }}.
  </div>
  <table id="write">
    <thead>
    <tr>
      <th></th>
      <th>{{ _('Item') }}</th>
      <th class="value">{{ _('Wert') }}</th>
      <th class="update">{{ _('Letztes Update') }}</th>
      <th class="change">{{ _('Letzte Änderung') }}</th>
    </tr>
    </thead>
    <tbody>
    {% for item in p._write_items %}
        <tr id="{{ item }}">
          <td></td>
          <td class="py-1" id="{{ item }}_path">{{ item }}</td>
          <td class="py-1" id="{{ item }}_value">{{ item.property.value }}</td>
          <td class="py-1" id="{{ item }}_lastupdate">
            {{ item.property.last_update.strftime('%d.%m.%Y %H:%M:%S') }}
          </td>
          <td class="py-1" id="{{ item }}_lastchange">
            {{ item.property.last_change.strftime('%d.%m.%Y %H:%M:%S') }}
          </td>
        </tr>

    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock bodytab2 %}
